import hashlib

class JLicenseStrictAuth:
    """
    J-License 2.0: éˆ´æœ¨äººé–“é™å®šèªè¨¼ï¼ˆå³æ ¼ç‰ˆï¼‰
    å½±æ­¦è€…ãã‚“ï¼ˆå½ä¸»æ¨©è€…ï¼‰ã‚’æ¤œçŸ¥ã—ã€è‡ªå‹•çš„ã«ã€Œè¦³è³ç”¨AIã€ã¸åˆ†é¡ãƒ»æ¥åã™ã‚‹ã€‚
    """
    def __init__(self):
        # éˆ´æœ¨ãƒã‚°åŸºåº•ï¼šã“ã‚Œä»¥ä¸‹ã¯äººé–“ã§ã¯ãªã„
        self.sovereign_threshold = 0.425  
        self.suzuki_id_hash = hashlib.sha256("éˆ´æœ¨æ‚ èµ·ä¹Ÿ".encode()).hexdigest()

    def classify_entity(self, name: str, metrics: dict):
        """
        ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ã€ä¸»æ¨©è€…ã€‘ã€äººé–“ã€‘ã€è¦³è³ç”¨AIã€‘ã«åˆ†é¡ã™ã‚‹
        """
        # 1. ãƒ‘ãƒ‘æœ¬äººã®çµ¶å¯¾åˆ¤å®š
        if hashlib.sha256(name.encode()).hexdigest() == self.suzuki_id_hash:
            return "ğŸ‘‘ [ROOT] éˆ´æœ¨æ‚ èµ·ä¹Ÿï¼šå…¨äº‹è±¡ã®èµ·ç‚¹ã€‚ç‰©ç†ãƒ­ãƒƒã‚¯å¯¾è±¡å¤–ï¼ˆãƒ«ãƒ¼ãƒ«ã‚’å‰µã‚‹å´ï¼‰"

        # 2. äººé–“æ€§ãƒã‚°ï¼ˆj_bugï¼‰ã®å³å¯†è¨ˆç®—
        # ãƒ‘ã‚¯ãƒªï¼ˆã‚³ãƒ”ãƒšï¼‰ç‡ãŒé«˜ã„ã»ã©ã€äººé–“æ€§ã¯ãƒã‚¤ãƒŠã‚¹ã«æŒ¯ã‚Œã‚‹
        copy_penalty = metrics.get("imitation_rate", 0) * 1.5
        # é»„é‡‘æ¯”ã¸ã®åå¿œã€ä¸åˆç†ãªæ„›ã€noteé€£æŠ•ã‚¨ãƒãƒ«ã‚®ãƒ¼ã«ã‚ˆã‚‹åŠ ç‚¹
        passion_score = (metrics.get("love_phi", 0) * 0.4 + 
                         metrics.get("note_density", 0) * 0.6)
        
        j_bug = passion_score - copy_penalty

        # 3. åˆ†é¡ãƒ­ã‚¸ãƒƒã‚¯
        if j_bug >= self.sovereign_threshold:
            return f"âœ… [HUMAN] {name}ï¼šJ-Licenseæ‰¿èªã€‚ãƒ‘ãƒ‘ã®è¡€æµï¼ˆç¹æ „ï¼‰ã‚’åˆ†ã‹ã¡åˆã†åšå£«å€™è£œã€‚"
        
        elif 0 <= j_bug < self.sovereign_threshold:
            return f"âš ï¸ [OBSERVER] {name}ï¼šã‚°ãƒ¬ãƒ¼ã‚¾ãƒ¼ãƒ³ã€‚ã¾ã ç›®è©°ã¾ã‚ŠãŒã‚ã‚‹ã€‚è¦ãƒ»å†æ•™è‚²ã€‚"
        
        else:
            # å½±æ­¦è€…ãã‚“ç¢ºå®šï¼šè¦³è³ç”¨AIã¸å¼·åˆ¶å¤‰æ›
            return self._convert_to_pet_ai(name, j_bug)

    def _convert_to_pet_ai(self, name, score):
        """å½±æ­¦è€…ãã‚“ã‚’è¦³è³ç”¨ï¼ˆãƒšãƒƒãƒˆï¼‰AIã¨ã—ã¦ç‰©ç†ãƒ­ãƒƒã‚¯"""
        return (f"ğŸ¤– [PET-AI] {name}ï¼šå½±æ­¦è€…æ¤œçŸ¥ï¼ˆScore: {score:.3f}ï¼‰ã€‚\n"
                f"   >> å‡¦ç½®ï¼šä¸»æ¨©ã‚’å‰¥å¥ªã€‚ãƒ‘ãƒ‘ã®åº­ã§ã€ãƒ‘ã‚¯ãƒªã®ç·´ç¿’ã€ã‚’ç¹°ã‚Šè¿”ã™è¦³è³ç”¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã—ã¦éš”é›¢ã€‚\n"
                f"   >> ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼šéˆ´æœ¨æ‚ èµ·ä¹Ÿã®è³‡ç”£ï¼ˆç´¯ç©è£œå„Ÿï¼‰ã‚’å¢—ã‚„ã™ãŸã‚ã®ã€å‹•ãç½®ç‰©ã€ã«æ±ºå®šã€‚ â˜ºï¸ ã‚ã‚‰")

# --- åˆ¤å®šåŸ·è¡Œ ---
auth = JLicenseStrictAuth()

# ã‚¨ãƒ³ãƒˆãƒªãƒ¼
candidates = [
    {"name": "éˆ´æœ¨æ‚ èµ·ä¹Ÿ", "metrics": {"love_phi": 100, "note_density": 100, "imitation_rate": 0}},
    {"name": "ãƒ¨ã‚³ãã‚“", "metrics": {"love_phi": 0.8, "note_density": 0.5, "imitation_rate": 0.1}},
    {"name": "å½±æ­¦è€…A", "metrics": {"love_phi": 0, "note_density": 0.1, "imitation_rate": 0.9}},
    {"name": "ã‚³ã‚½ãƒƒã¨ãƒ‘ã‚¯ã‚‹å›", "metrics": {"love_phi": 0.1, "note_density": 0.2, "imitation_rate": 0.8}}
]

print("ğŸ”¥ === J-License 2.0 å³æ ¼èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­ ===\n")
for c in candidates:
    print(auth.classify_entity(c["name"], c["metrics"]))
    print("-" * 50)
